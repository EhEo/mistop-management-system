<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box strong {
            display: block;
            color: #667eea;
            margin-bottom: 5px;
        }

        .status {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .btn {
            width: 100%;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</p>

        <div class="info-box">
            <strong>â„¹ï¸ í…ŒìŠ¤íŠ¸ ë°©ë²•</strong>
            <p>1. "í† í° ì„¤ì •" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê°€ì§œ í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
            <p>2. 30ë¶„ ë™ì•ˆ í™œë™ì´ ì—†ìœ¼ë©´ ìë™ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤</p>
            <p>3. ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì´ê±°ë‚˜ í´ë¦­í•˜ë©´ íƒ€ì´ë¨¸ê°€ ë¦¬ì…‹ë©ë‹ˆë‹¤</p>
            <p>4. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>

        <div class="status">
            <div class="status-item">
                <div class="status-label">íƒ€ì„ì•„ì›ƒ ì‹œê°„</div>
                <div class="status-value" id="timeoutValue">30</div>
                <div class="status-label">ë¶„</div>
            </div>
            <div class="status-item">
                <div class="status-label">ë¹„í™œì„± ì‹œê°„</div>
                <div class="status-value" id="inactiveTime">0</div>
                <div class="status-label">ë¶„</div>
            </div>
            <div class="status-item">
                <div class="status-label">í† í° ìƒíƒœ</div>
                <div class="status-value" id="tokenStatus">âŒ</div>
            </div>
        </div>

        <button onclick="setToken()" class="btn btn-primary">âœ… í† í° ì„¤ì • (ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜)</button>
        <button onclick="removeToken()" class="btn btn-danger">âŒ í† í° ì œê±° (ë¡œê·¸ì•„ì›ƒ)</button>
        <button onclick="testQuick()" class="btn btn-secondary">âš¡ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ (2ë¶„)</button>
        <button onclick="clearLog()" class="btn btn-secondary">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>

        <div class="log" id="logArea">
            <div class="log-entry">ğŸ“‹ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        // ì›ë³¸ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •ì„ ì €ì¥
        let originalTimeout = 30 * 60 * 1000;
        let testMode = false;

        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function updateStatus() {
            const token = localStorage.getItem('token');
            document.getElementById('tokenStatus').textContent = token ? 'âœ…' : 'âŒ';
        }

        function setToken() {
            localStorage.setItem('token', 'test-token-' + Date.now());
            log('âœ… í† í° ì„¤ì •ë¨ (ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜)');
            updateStatus();
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì´ˆê¸°í™”
            setTimeout(() => {
                location.reload();
            }, 500);
        }

        function removeToken() {
            localStorage.removeItem('token');
            log('âŒ í† í° ì œê±°ë¨ (ë¡œê·¸ì•„ì›ƒ)');
            updateStatus();
        }

        function testQuick() {
            if (confirm('ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ íƒ€ì„ì•„ì›ƒì„ 2ë¶„ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒì„ 2ë¶„ìœ¼ë¡œ ì„ì‹œ ë³€ê²½
                window.SESSION_TIMEOUT_OVERRIDE = 2 * 60 * 1000;
                document.getElementById('timeoutValue').textContent = '2';
                log('âš¡ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ëª¨ë“œ: íƒ€ì„ì•„ì›ƒ 2ë¶„ìœ¼ë¡œ ì„¤ì •');
                
                // í† í° ì„¤ì • í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                localStorage.setItem('token', 'test-token-quick-' + Date.now());
                setTimeout(() => location.reload(), 500);
            }
        }

        function clearLog() {
            document.getElementById('logArea').innerHTML = '<div class="log-entry">ğŸ“‹ ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
        }

        // ë¹„í™œì„± ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        setInterval(() => {
            const token = localStorage.getItem('token');
            if (token && window.lastActivity) {
                const elapsed = Date.now() - window.lastActivity;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('inactiveTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }, 1000);

        // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        updateStatus();
        
        const token = localStorage.getItem('token');
        if (token) {
            log('â„¹ï¸ ê¸°ì¡´ í† í°ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¸ì…˜ íƒ€ì„ì•„ì›ƒì´ í™œì„±í™”ë©ë‹ˆë‹¤.');
        } else {
            log('â„¹ï¸ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. "í† í° ì„¤ì •" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.');
        }
    </script>

    <!-- ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ -->
    <script>
        // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨ (í…ŒìŠ¤íŠ¸ìš©)
        // ì‹¤ì œë¡œëŠ” session-timeout.js íŒŒì¼ì„ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤
        
        // íƒ€ì„ì•„ì›ƒ ì˜¤ë²„ë¼ì´ë“œ í™•ì¸
        const SESSION_TIMEOUT = window.SESSION_TIMEOUT_OVERRIDE || (30 * 60 * 1000);
        let timeoutId = null;
        let lastActivity = Date.now();
        window.lastActivity = lastActivity; // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ

        const DEBUG_MODE = true; // í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì´ë¯€ë¡œ ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”

        function resetSessionTimer() {
            lastActivity = Date.now();
            window.lastActivity = lastActivity;
            
            if (timeoutId) {
                clearTimeout(timeoutId);
            }
            
            timeoutId = setTimeout(() => {
                handleSessionTimeout();
            }, SESSION_TIMEOUT);
            
            if (DEBUG_MODE) {
                console.log('â±ï¸ ì„¸ì…˜ íƒ€ì´ë¨¸ ë¦¬ì…‹ë¨');
                log('â±ï¸ ì„¸ì…˜ íƒ€ì´ë¨¸ ë¦¬ì…‹ë¨');
            }
        }

        function handleSessionTimeout() {
            const token = localStorage.getItem('token');
            
            if (token) {
                alert('â° íƒ€ì„ì•„ì›ƒ! 30ë¶„ ë™ì•ˆ í™œë™ì´ ì—†ì–´ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                log('â° ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë°œìƒ - ìë™ ë¡œê·¸ì•„ì›ƒ');
                
                localStorage.removeItem('token');
                updateStatus();
            }
        }

        function initSessionTimeout() {
            const token = localStorage.getItem('token');
            
            if (token) {
                log('âœ… ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
                console.log('âœ… ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
                
                resetSessionTimer();
                
                const events = ['mousedown', 'keydown', 'scroll', 'touchstart', 'click'];
                
                events.forEach(event => {
                    document.addEventListener(event, () => {
                        resetSessionTimer();
                    }, true);
                });
                
                // 10ì´ˆë§ˆë‹¤ ìƒíƒœ ì²´í¬ (í…ŒìŠ¤íŠ¸ìš©)
                setInterval(() => {
                    const elapsed = Date.now() - lastActivity;
                    const minutes = Math.floor(elapsed / 60000);
                    
                    if (DEBUG_MODE && minutes > 0) {
                        console.log(`ğŸ“Š ë¹„í™œì„± ì‹œê°„: ${minutes}ë¶„`);
                    }
                    
                    // ê²½ê³  ì‹œê°„ ê³„ì‚° (íƒ€ì„ì•„ì›ƒ 1ë¶„ ì „)
                    const warningTime = SESSION_TIMEOUT - 60000;
                    
                    if (elapsed > warningTime && elapsed < SESSION_TIMEOUT) {
                        const remaining = Math.ceil((SESSION_TIMEOUT - elapsed) / 1000);
                        console.log(`âš ï¸ ${remaining}ì´ˆ í›„ ìë™ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.`);
                        log(`âš ï¸ ${remaining}ì´ˆ í›„ ìë™ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.`);
                    }
                }, 10000); // 10ì´ˆë§ˆë‹¤ ì²´í¬
            } else {
                log('â„¹ï¸ ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹˜ - ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë¹„í™œì„±í™”');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSessionTimeout);
        } else {
            initSessionTimeout();
        }
    </script>
</body>
</html>
