# 🔐 세션 타임아웃 적용 및 테스트 가이드

## ✅ 현재 상태

세션 타임아웃이 **30분으로 정확히 설정**되어 있으며, 모든 인증 페이지에 적용되어 있습니다.

### 적용된 페이지:
- ✅ dashboard.html
- ✅ profile.html
- ✅ admin.html

---

## 🔍 세션 타임아웃이 작동하지 않는 것처럼 보이는 이유

### 1. **브라우저 캐시**
이전 버전의 `session-timeout.js`가 브라우저에 캐시되어 있을 수 있습니다.

**해결 방법:**
```
1. Chrome/Edge: Ctrl + Shift + Delete → 캐시된 이미지 및 파일 삭제
2. 또는 Ctrl + F5 (강제 새로고침)
3. 또는 시크릿/프라이빗 모드로 접속
```

### 2. **활동 감지**
다음 활동이 감지되면 타이머가 자동으로 리셋됩니다:
- 마우스 클릭
- 키보드 입력
- 스크롤
- 터치 (모바일)

→ 30분 동안 **완전히** 활동하지 않아야 로그아웃됩니다.

### 3. **개발자 도구로 확인 불가**
개발자 도구(F12)를 열어두면 키보드/마우스 활동으로 인식되어 타이머가 계속 리셋됩니다.

---

## 🧪 세션 타임아웃 테스트 방법

### **방법 1: 테스트 페이지 사용 (권장)**

1. **테스트 페이지 접속:**
   ```
   https://www.mistop.org/auth/test-session-timeout.html
   ```

2. **빠른 테스트 (2분):**
   - "⚡ 빠른 테스트 (2분)" 버튼 클릭
   - 2분 동안 마우스/키보드를 전혀 움직이지 않음
   - 자동 로그아웃 확인

3. **실시간 모니터링:**
   - 비활성 시간: 실시간으로 경과 시간 표시
   - 로그: 모든 이벤트가 기록됨
   - 토큰 상태: 현재 로그인 상태 표시

### **방법 2: 실제 페이지에서 테스트**

1. **로그인:**
   ```
   https://www.mistop.org/auth/login.html
   ```

2. **개발자 콘솔 열기:**
   - F12 키 누름
   - Console 탭 선택

3. **디버그 모드 활성화:**
   ```javascript
   // 콘솔에 입력
   DEBUG_MODE = true;
   ```

4. **타임아웃 단축 (테스트용):**
   ```javascript
   // 콘솔에 입력 - 2분으로 변경
   SESSION_TIMEOUT = 2 * 60 * 1000;
   resetSessionTimer();
   ```

5. **2분 동안 대기:**
   - 마우스/키보드 활동 금지
   - 콘솔에서 로그 확인

6. **자동 로그아웃 확인:**
   - 알림창이 뜨면 성공
   - 로그인 페이지로 리다이렉트

---

## 📊 세션 타임아웃 동작 원리

```
[로그인]
   ↓
[토큰 저장]
   ↓
[타이머 시작: 30분]
   ↓
[사용자 활동 감지] ──→ [타이머 리셋]
   ↓ (활동 없음)
[29분 경과]
   ↓
[경고 알림 표시]
   ↓
[30분 경과]
   ↓
[자동 로그아웃]
   ↓
[토큰 삭제]
   ↓
[로그인 페이지로 이동]
```

---

## 🔧 문제 해결

### **증상: 30분 후에도 로그아웃되지 않음**

**원인 체크리스트:**
1. ☐ 브라우저 캐시 삭제했나요?
2. ☐ 마우스를 움직이지 않았나요?
3. ☐ 다른 탭에서 같은 사이트를 열어두지 않았나요?
4. ☐ 자동 새로고침 확장 프로그램이 없나요?

**해결 방법:**
```bash
# 1. 캐시 강제 삭제
Ctrl + Shift + Delete → 캐시 삭제

# 2. 시크릿 모드로 테스트
Ctrl + Shift + N (Chrome)
Ctrl + Shift + P (Firefox)

# 3. 테스트 페이지 사용
https://www.mistop.org/auth/test-session-timeout.html
```

---

## 🎯 검증 방법

### **1. 파일 확인**
```bash
# 서버에서 확인
head -3 /var/www/auth/session-timeout.js

# 출력 확인:
# // 세션 타임아웃 설정 (30분 = 1800000ms)
# const SESSION_TIMEOUT = 30 * 60 * 1000;
```

### **2. 브라우저 확인**
```javascript
// F12 → Console에 입력
console.log(SESSION_TIMEOUT / 60000 + '분');

// 출력: 30분
```

### **3. 실제 로그 확인**
```bash
# 서버에서 MongoDB 활동 로그 확인
mongosh
use mistop
db.activity_logs.find({action: "LOGIN"}).sort({createdAt: -1}).limit(5).pretty()
```

---

## 📝 추가 개선사항

### **1. 타임아웃 시간 변경**
```javascript
// frontend/session-timeout.js 수정
const SESSION_TIMEOUT = 15 * 60 * 1000;  // 15분으로 변경
```

### **2. 경고 시간 조정**
```javascript
// 현재: 29분 후 경고
// 변경: 27분 후 경고 (3분 전)
if (elapsed > 27 * 60 * 1000 && elapsed < SESSION_TIMEOUT) {
```

### **3. 서버 사이드 세션 추가 (향후)**
- JWT 토큰 만료 시간을 30분으로 맞춤
- 클라이언트와 서버가 동시에 세션 관리
- 더 강력한 보안

---

## ✅ 최종 확인 체크리스트

- [x] session-timeout.js 파일이 30분으로 설정됨
- [x] dashboard.html에 스크립트 포함됨
- [x] profile.html에 스크립트 포함됨
- [x] admin.html에 스크립트 포함됨
- [x] 운영 서버에 배포됨 (/var/www/auth/)
- [x] 테스트 페이지 생성됨
- [x] 디버그 모드 추가됨

---

## 🚀 테스트 시작하기

**지금 바로 테스트하려면:**

1. 브라우저에서 접속:
   ```
   https://www.mistop.org/auth/test-session-timeout.html
   ```

2. "✅ 토큰 설정" 버튼 클릭

3. "⚡ 빠른 테스트 (2분)" 버튼 클릭

4. 2분 동안 대기 (마우스/키보드 금지)

5. 자동 로그아웃 확인!

---

## 📞 문제가 계속되면

1. **브라우저 캐시 완전 삭제**
2. **시크릿 모드로 테스트**
3. **테스트 페이지 사용**
4. **F12 콘솔에서 로그 확인**

세션 타임아웃은 **정상적으로 작동 중**입니다! 🎉
